{% extends "common/base.html" %}

{% block title %}æŠ•ç¨¿ã‚’ç·¨é›† - STLæ²ç¤ºæ¿{% endblock %}

{% block content %}

<script type="module" src="https://unpkg.com/@google/model-viewer/dist/model-viewer.min.js"></script>

<style>
.current-content-preview {
  background: #f8f9fa;
  border: 1px solid #dee2e6;
  border-radius: 8px;
  padding: 20px;
  margin-bottom: 30px;
}

.preview-label {
  font-weight: bold;
  color: #495057;
  margin-bottom: 8px;
}

.model-viewer-container {
  margin: 15px 0;
  border-radius: 12px;
  overflow: hidden;
  border: 1px solid #e1e8ed;
  background: #f5f8fa;
}

.preview-image {
  max-width: 100%;
  height: auto;
  border-radius: 10px;
  border: 1px solid #dee2e6;
  display: block;
}
</style>

<!-- ãƒ‘ãƒ³ããšãƒŠãƒ“ -->
<nav class="breadcrumb-nav" aria-label="breadcrumb">
    <ol class="breadcrumb">
        <li class="breadcrumb-item"><a href="/">ãƒ›ãƒ¼ãƒ </a></li>
        <li class="breadcrumb-item"><a href="/stl_board">STLæ²ç¤ºæ¿</a></li>
        <li class="breadcrumb-item active" aria-current="page">æŠ•ç¨¿ç·¨é›†</li>
    </ol>
</nav>

<div class="container mt-4" style="max-width: 1000px;">
  <div class="mb-3">
    <a href="{{ url_for('stl_board.view_post', post_id=post_id) }}" class="btn btn-outline-secondary">
      â† æŠ•ç¨¿ã«æˆ»ã‚‹
    </a>
  </div>

  {# â˜… ç¾åœ¨ã®æŠ•ç¨¿å†…å®¹ã®ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ #}
  <div class="current-content-preview">
    <h4 class="mb-3">ğŸ“‹ ç¾åœ¨ã®æŠ•ç¨¿å†…å®¹</h4>

    <div class="mb-3">
      <div class="preview-label">ã‚¿ã‚¤ãƒˆãƒ«:</div>
      <div>{{ current_post.title or "ï¼ˆã‚¿ã‚¤ãƒˆãƒ«ãªã—ï¼‰" }}</div>
    </div>

    <div class="mb-3">
      <div class="preview-label">å†…å®¹:</div>
      <div style="white-space: pre-line;">{{ current_post.content or "ï¼ˆå†…å®¹ãªã—ï¼‰" }}</div>
    </div>

    {# â˜… ç”»åƒãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ï¼ˆè¿½åŠ ï¼‰ #}
    {% if current_post.image_url %}
    <div class="mb-3">
      <div class="preview-label">ç”»åƒ:</div>
      <img src="{{ current_post.image_url }}" alt="post image" class="preview-image">
    </div>
    {% endif %}

    {% if current_post.youtube_url %}
    <div class="mb-3">
      <div class="preview-label">YouTube URL:</div>
      <div>
        <a href="{{ current_post.youtube_url }}" target="_blank">{{ current_post.youtube_url }}</a>
      </div>

      {# YouTubeå‹•ç”»ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ #}
      {% if current_post.youtube_embed_url %}
      <div class="model-viewer-container mt-2">
        <div class="ratio ratio-16x9">
          <iframe src="{{ current_post.youtube_embed_url }}"
                  allowfullscreen
                  frameborder="0"
                  allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture">
          </iframe>
        </div>
      </div>
      {% endif %}
    </div>
    {% endif %}

    {% if current_post.s3_presigned_url %}
    <div class="mb-3">
      <div class="preview-label">STLãƒ•ã‚¡ã‚¤ãƒ«:</div>
      <div class="model-viewer-container">
        <model-viewer src="{{ current_post.s3_presigned_url }}"
                      auto-rotate
                      camera-controls
                      style="width: 100%; height: 400px; background-color: #fff;">
        </model-viewer>
      </div>
    </div>
    {% endif %}
  </div>

  {# ç·¨é›†ãƒ•ã‚©ãƒ¼ãƒ  #}
  <div class="card">
    <div class="card-body">
      <h3 class="mb-4">âœï¸ ç·¨é›†ãƒ•ã‚©ãƒ¼ãƒ </h3>

      <form method="POST" enctype="multipart/form-data">
        {{ form.hidden_tag() }}

        <div class="mb-3">
          {{ form.title.label(class="form-label") }}
          {{ form.title(class="form-control", placeholder="ã‚¿ã‚¤ãƒˆãƒ«ã‚’å…¥åŠ›") }}
          {% if form.title.errors %}
            <div class="text-danger">{{ form.title.errors[0] }}</div>
          {% endif %}
        </div>

        <div class="mb-3">
          {{ form.content.label(class="form-label") }}
          {{ form.content(class="form-control", rows=5, placeholder="å†…å®¹ã‚’å…¥åŠ›") }}
          {% if form.content.errors %}
            <div class="text-danger">{{ form.content.errors[0] }}</div>
          {% endif %}
        </div>

        <div class="mb-3">
          {{ form.stl_file.label(class="form-label") }}
          {{ form.stl_file(class="form-control") }}
          <div class="form-text">
            æ–°ã—ã„STLãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã™ã‚‹å ´åˆã®ã¿é¸æŠã—ã¦ãã ã•ã„ï¼ˆ5MBä»¥å†…ï¼‰<br>
            é¸æŠã—ãªã„å ´åˆã¯ç¾åœ¨ã®ãƒ•ã‚¡ã‚¤ãƒ«ãŒä¿æŒã•ã‚Œã¾ã™
          </div>
          {% if form.stl_file.errors %}
            <div class="text-danger">{{ form.stl_file.errors[0] }}</div>
          {% endif %}
        </div>

        {# â˜… ç”»åƒã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ï¼ˆè¿½åŠ ï¼‰ #}
        <div class="mb-3">
          {{ form.image_file.label(class="form-label") }}
          {{ form.image_file(class="form-control") }}
          <div class="form-text">
            æ–°ã—ã„ç”»åƒã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã™ã‚‹å ´åˆã®ã¿é¸æŠã—ã¦ãã ã•ã„ï¼ˆé¸æŠã—ãªã„å ´åˆã¯ç¾åœ¨ã®ç”»åƒãŒä¿æŒã•ã‚Œã¾ã™ï¼‰
          </div>
          {% if form.image_file.errors %}
            <div class="text-danger">{{ form.image_file.errors[0] }}</div>
          {% endif %}
        </div>

        <div class="mb-3">
          {{ form.youtube_url.label(class="form-label") }}
          {{ form.youtube_url(class="form-control", placeholder="https://www.youtube.com/watch?v=...") }}
          <div class="form-text">YouTubeå‹•ç”»ã®URLã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ï¼ˆç©ºæ¬„ã«ã™ã‚‹ã¨å‰Šé™¤ã•ã‚Œã¾ã™ï¼‰</div>
          {% if form.youtube_url.errors %}
            <div class="text-danger">{{ form.youtube_url.errors[0] }}</div>
          {% endif %}
        </div>

        <div class="d-flex gap-2">
          <button type="submit" class="btn btn-primary">âœ… æ›´æ–°ã™ã‚‹</button>
          <a href="{{ url_for('stl_board.view_post', post_id=post_id) }}" class="btn btn-secondary">
            ã‚­ãƒ£ãƒ³ã‚»ãƒ«
          </a>
        </div>
      </form>
    </div>
  </div>
</div>

{% endblock %}
