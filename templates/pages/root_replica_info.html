{% extends "common/base.html" %}

{# SEO最適化 #}
{% block title %}自家歯牙移植とは | 渋谷歯科技工所{% endblock %}
{% block description %}自家歯牙移植について詳しく解説。ドナー歯の選定から移植手術、成功率まで専門的な情報をわかりやすく説明します。埼玉県越谷市の渋谷歯科技工所【電話】048-961-8151{% endblock %}
{% block keywords %}自家歯牙移植,歯牙移植,ドナー歯,移植手術,歯科治療,埼玉県,越谷市,渋谷歯科技工所,3Dレプリカ,成功率,適応症{% endblock %}

{% block og_type %}article{% endblock %}

{% block extra_meta %}
  {# Twitter Card #}
  <meta name="twitter:title" content="自家歯牙移植とは | 専門解説">
  <meta name="twitter:description" content="ドナー歯の選定から移植手術まで、自家歯牙移植について専門的にわかりやすく解説します。">

  {# 構造化データ（医療記事として） #}
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "MedicalWebPage",
    "name": "自家歯牙移植とは",
    "description": "自家歯牙移植について詳しく解説する専門ページ",
    "url": "https://shibuya8020.com/pages/root_replica_info",
    "mainEntity": {
      "@type": "MedicalProcedure",
      "name": "自家歯牙移植",
      "alternateName": "歯牙移植",
      "description": "患者自身の健康な歯を抜歯部位に移植する歯科治療法",
      "procedureType": "外科手術",
      "bodyLocation": {
        "@type": "AnatomicalStructure",
        "name": "口腔"
      }
    },
    "author": {
      "@type": "Organization",
      "name": "渋谷歯科技工所",
      "url": "https://shibuya8020.com/"
    },
    "publisher": {
      "@type": "Organization",
      "name": "渋谷歯科技工所",
      "logo": {
        "@type": "ImageObject",
        "url": "https://shibuya8020.com/images/logo02.jpg"
      }
    },
    "datePublished": "2024-01-01T09:00:00+09:00",
    "dateModified": "2024-08-27T10:00:00+09:00"
  }
  </script>

  {# 医療関連のメタタグ #}
  <meta name="medical-disclaimer" content="本サイトの情報は医学的アドバイスではありません。治療については必ず医師にご相談ください。">
{% endblock %}

{% block content %}

<style>
    .box_root_replica_info { 
         margin: 20px auto;
        
    }
    .box_root_replica_info ul { 
        width: 80%; 
        margin: 0 auto; 
        max-width: 800px; 
    }
    div.box_root_replica_info > table { 
        width: 80%; 
        margin: 0 auto; 
        max-width: 600px; 
    }
    .box_root_replica_info img {
        display: block;
        margin: 0 auto;
        max-width: 100%;
    }
      .latest-qa-section {
        background-color: #f8f9fa;
        border: 1px solid #dee2e6;
        border-radius: 8px;
        padding: 25px;
        margin-top: 40px;
    }
    
    .latest-qa-item {
        background-color: white;
        border-radius: 6px;
        padding: 20px;
        margin-bottom: 15px;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    .qa-question {
        font-size: 18px;
        font-weight: bold;
        color: #2c3e50;
        margin-bottom: 15px;
        padding-left: 25px;
        position: relative;
    }
    .qa-question {
        font-size: 18px;
        font-weight: bold;
        color: #2c3e50;
        margin-bottom: 15px;
        padding-left: 25px;
        position: relative;
    }
    
    .qa-question:before {
        content: "Q";
        position: absolute;
        left: 0;
        top: 0;
        background-color: #007bff;
        color: white;
        width: 20px;
        height: 20px;
        border-radius: 50%;
        font-size: 12px;
        font-weight: bold;
        display: flex;
        align-items: center;
        justify-content: center;
    }
     .qa-answer {
        padding-left: 25px;
        position: relative;
        line-height: 1.7;
        color: #495057;
    }
    
    .qa-answer:before {
        content: "A";
        position: absolute;
        left: 0;
        top: 0;
        background-color: #28a745;
        color: white;
        width: 20px;
        height: 20px;
        border-radius: 50%;
        font-size: 12px;
        font-weight: bold;
        display: flex;
        align-items: center;
        justify-content: center;
    }
    .qa-input-container {
        position: relative;
    }
    
    .qa-input {
        width: 100%;
        padding: 15px;
        border: 2px solid #007bff;
        border-radius: 8px;
        font-size: 16px;
        resize: vertical;
        min-height: 80px;
    }
    
    .qa-input:focus {
        outline: none;
        border-color: #0056b3;
        box-shadow: 0 0 0 0.2rem rgba(0, 123, 255, 0.25);
    }
</style>

<nav class="breadcrumb-nav" aria-label="breadcrumb">
        <ol class="breadcrumb">
            <li class="breadcrumb-item"><a href="/">ホーム</a></li>
            <li class="breadcrumb-item active" aria-current="page">自家歯牙移植とは</li>
        </ol>
    </nav>

<div class="text-center">
    <h1>自家歯牙移植とは</h1>
    <p>自家歯牙移植とは、むし歯や歯周病などで失った歯のあったところに、自分の別の歯（親知らずなど）を移す治療法です。</p>
    <p>自分の歯を利用するため生体に優しく、元の歯の機能をそのまま活かすことができる治療法です。</p>
  </div>

  <div class="box_root_replica_info">
    <h2>歯の保存について</h2>
    <p>抜歯した歯（親知らずや矯正で抜いた歯など）は「<a href="http://www.teethbank.jp/" target="_blank">歯の銀行（ティースバンク）</a>」で冷凍保存することができます。</p>
    <p>20年以上保存が可能で、将来必要になった時に自家歯牙移植に利用できます。</p>
    
</div>

<div class="box_root_replica_info">
    <h2>自家歯牙移植の成功率を高める要素</h2>

    <h2>重要な成功条件</h2>
    <ul>
        <li><strong>迅速な処置</strong>: 抜歯後、すぐに移植床に植立すること</li>
        <li><strong>歯根膜の保護</strong>: 歯根周囲組織（特に歯根膜）を損傷しないこと</li>
        <li><strong>年齢</strong>: 40歳以下が望ましい（ただし70歳でも成功例あり）</li>
        <li><strong>適切な骨幅</strong>: 移植歯に対して適正な骨幅があること</li>
    </ul>
    </div>   

<div class="box_root_replica_info">
<h2>自家歯牙移植の特徴</h2>
    <ul>
        <li><strong>歯根膜感覚</strong>: 天然歯と同様、自分の歯で噛んでいる感覚がある。</li>
        <li><strong>生理的な動揺</strong>: 歯根膜空隙があるため、自然な動きがある</li>
        <li><strong>矯正治療が可能</strong>: 必要に応じて歯の移動ができる</li>
        <li><strong>顎骨の成長に対応</strong>: 天然歯と同様に成長発育に対応できる</li>
    </ul>
</div>

<div class="box_root_replica_info">
<h2>インプラントとの違い</h2>
<table>
    <tr>
        <th>自家歯牙移植</th>
        <th>インプラント</th>
    </tr>
    <tr>
        <td>自分の歯を使用</td>
        <td>人工物（チタンなど）</td>
    </tr>
    <tr>
        <td>歯根膜あり（緩衝材の役割）</td>
        <td>歯根膜なし（骨と直接結合）</td>
    </tr>
    <tr>
        <td>自然な咬合感覚</td>
        <td>異物感を感じることがある</td>
    </tr>
    <tr>
        <td>矯正移動が可能</td>
        <td>移動不可</td>
    </tr>
</table>

</div>



<div class="box_root_replica_info">
<h2>3Dレプリカの重要性</h2>
        
<div class="box_root_replica_info">
    <img src="{{ url_for('static', filename='pages/root_replica/029.jpg') }}">
</div>

    <div class="box_root_replica_info">
        <h2>自家歯牙移植用レプリカの役割</h2>
        <p><strong>3Dレプリカとは、移植歯のCTデータから作成された精密な複製モデルです。これを使用することで：</strong></p>
        <ul>
            <li>移植前に移植床を正確に形成できる</li>
            <li>移植歯の抜歯後、短時間で適切に植立できる</li>
            <li>歯根膜へのダメージを最小限に抑えられる</li>
            <li>歯根膜（特にマラッセの上皮遺残）の保護</li>
            <li>歯根未完成歯の場合はヘルトヴィッヒ上皮鞘の保護も重要</li>
            <li>事前に移植シミュレーションが可能（歯の回転や位置調整など）</li>
        </ul>
    </div>

    <div class="box_root_replica_info">
        <p><strong>従来の方法（レプリカなし）では：</strong></p>
        <ul>
            <li>移植歯を抜歯後、その歯を合わせながら移植床を形成する必要があった</li>
            <li>処置時間が長くなり、歯根膜が損傷するリスクが高かった</li>
        </ul>
    </div>
    <div class="box_root_replica_info">
    <p>3Dレプリカとは移植歯の抜歯前に移植歯が入りやすくするために移植床を形成するためのレプリカです。<br>
    移植において最も大切な組織は「歯根膜」ですので移植する歯の「歯根膜」にダメージを与えないことが大事です。<br>
    レプリカを事前に準備しておくことで移植歯を抜歯し短時間で移植床に植立でき成功率を上げることができます。<br>
    短時間で適切な深さ、隙間を空けて移植するためには正確なドナーレプリカ(3Dレプリカ)は欠かせません。</p>
    </div>

<p>3Dレプリカを活用することで、自家歯牙移植の成功率を大幅に向上させることができます。</p>
</div>

  <!-- 最新のQ&A（動的に更新される部分） -->
    <section class="latest-qa-section">
        <h2>患者様から寄せられた質問をご紹介します</h2> 

        <div class="latest-qa-item">            
            <div class="qa-question">自家歯牙移植は誰でも受けられますか？</div>
            <div class="qa-answer">
            自家歯牙移植は、すべての人が受けられるわけではありません。適応症や患者の全身的状態、口腔内の状況などを考慮して判断されます。特に、移植歯と骨幅の合致や歯根膜の状態、患者の年齢（40歳以下が望ましい）などが重要な要素となります。また、カリエスリスクが低いことも望ましい条件です。したがって、個々のケースに応じて歯科医師が適切な判断を行います。。
            </div>
        </div>
        
        <div class="latest-qa-item">            
            <div class="qa-question">自家歯牙移植とはどのような治療ですか？</div>
            <div class="qa-answer">
            自家歯牙移植は、患者自身の口腔内から健康な歯を取り出し、別の部位に移植する治療法です。この方法は、特にインプラントや義歯、ブリッジに比べて審美性や機能性の回復が期待できる場合があります。移植に適したドナー歯がある場合、天然歯特有の利点を活かし、早期に審美性と機能性を回復することが可能です。
            自家歯牙移植の成功には、ドナー歯の形態や受容部位の状態、術後の管理が重要です。例えば、歯根膜の骨誘導能を活かして、骨の再生を促すことができる場合があります。また、移植後の固定や歯冠修復には、コンポジットレジンを用いることが多く、将来的な再修復が容易であることも利点の一つです。
            ただし、移植にはリスクも伴い、歯根吸収や歯髄の治癒が期待できない場合もあります。したがって、適切な診断と計画、術後のモニタリングが重要です。
            </div>
        </div>

        <div class="latest-qa-item">            
            <div class="qa-question">どのような場合に自家歯牙移植が適用されますか？</div>
            <div class="qa-answer">
            自家歯牙移植が適用される場合には、いくつかの条件があります。<br>
            まず、移植する歯と受容部の骨の幅が適切に合っていることが重要です。また、移植歯の歯根形態が円錐形で単純であることが望ましく、これにより成功率が高まります。さらに、抜歯と同時に移植を行うことで治癒が早まり、成功率が向上します。カリエスリスクが低く、移植後の管理がしやすいことも重要です。一般的に、若年者（40歳以下）が望ましく、特に歯根が未完成の歯の移植は有用とされています。これらの条件を満たす場合、自家歯牙移植は他の治療法に比べて有利であると考えられます。
                
            </div>
        </div>

        <div class="latest-qa-item">            
            <div class="qa-question">移植した歯でちゃんと噛めるようになりますか？</div>
            <div class="qa-answer">
            移植した歯が機能的に噛めるようになるかどうかは、いくつかの要因に依存します。まず、移植後の固定と安定性が重要で、適切に固定され安定すれば噛む機能が回復する可能性が高まります。また、歯根膜の健康状態が良好であれば、歯槽骨との結合が期待でき、噛む機能が回復しやすくなります。術後の経過観察も重要で、定期的なエックス線検査や動揺度のチェックを行い、歯が正常に機能しているかを確認します。さらに、矯正治療を併用することで、歯の位置や噛み合わせを調整し、機能的に噛めるようにすることが可能です。患者の協力も重要で、術後の口腔衛生管理や定期的な歯科受診が求められます。これらの要因が整えば、移植した歯で正常に噛むことが可能になると考えられます。ただし、個々の症例によって異なるため、具体的な治療計画や予後については担当の歯科医師と相談することが重要です。
            </div>
        </div>
      
        <div class="latest-qa-item">            
            <div class="qa-question">手術の痛みはどの程度ですか？</div>
            <div class="qa-answer">
            自家歯牙移植の手術においては、通常、局所麻酔が施されるため、手術中の痛みはほとんど感じないとされています。術前には抗生物質の投与や口腔内の消毒が行われ、手術の際には局所麻酔が使用されることが一般的です。術後に関しては、多少の不快感や痛みが生じることがありますが、これは通常、鎮痛剤で管理可能です。具体的な痛みの程度や術後の経過については、個々の症例や患者の状態によって異なるため、担当の歯科医師に相談することが重要です。
            </div>
        </div>

        <div class="latest-qa-item">            
            <div class="qa-question">成功率はどの程度ですか？</div>
            <div class="qa-answer">
            歯科治療における移植の成功率は、移植の種類や条件によって異なります。抜歯窩への移植では成功率が非常に高く、95%に達します。一方、非抜歯窩への移植では成功率が60%とやや低くなります。年齢も影響し、40歳以上での非抜歯窩への移植の成功率は49%ですが、39歳以下では75%と高くなります。また、外科的挺出を用いた場合の成功率は約95%です。これらのデータから、移植の成功率は受容側の条件や患者の年齢に大きく影響されることがわかります。
            </div>
        </div>

        <div class="latest-qa-item">            
            <div class="qa-question">40歳でも自家歯牙移植できますか？</div>
            <div class="qa-answer">
            40歳でも自家歯牙移植は可能です。ただし、年齢が上がるにつれて成功率が低下する傾向があります。<br>
            一般的には40歳以下の患者が望ましいとされていますが、40歳以上でも個々の歯や口腔内の状況によっては移植が可能な場合があります。<br>
            年齢が上がると歯根膜の厚みが減少し、インプラントが有利になることもありますが、適切なケースでは40歳以上でも自家歯牙移植が成功することがあります。抜歯窩への移植では成功率が60%とやや低くなります。
            年齢も影響し、40歳以上での非抜歯窩への移植の成功率は49%ですが、39歳以下では75%と高くなります。また、外科的挺出を用いた場合の成功率は約95%です。これらのデータから、移植の成功率は受容側の条件や患者の年齢に大きく影響されることがわかります。
            </div>
        </div>

        <div class="latest-qa-item">            
            <div class="qa-question">治療期間はどのくらいかかりますか？</div>
            <div class="qa-answer">
            自家歯牙移植の治療期間は、移植手術から始まり、術後の経過観察や必要な処置を含めて数か月から数年にわたります。具体的な流れは以下の通りです：
            移植手術: 移植手術自体は1日で行われます。
            術後管理:
            術後1週間目: 抜糸を行い、ブラッシングを開始します。
            術後3週間目: 歯根完成歯の場合は根管治療を開始します。
            術後1か月目: 固定を除去し、通常の食物の咀嚼を開始します。
            術後4か月目: テンポラリークラウンを装着します。
            術後6か月目: 修復処置や補綴物装着を行います。
            経過観察:
            移植後3か月後、6か月後、1年後にエックス線写真検査を行い、その後は2-3年ごとの経過観察を行います。
            このように、移植後の治癒や安定を確認しながら、必要な処置を行っていくため、全体の治療期間は数年にわたることがあります。
            </div>
        </div>

        <div class="latest-qa-item">            
            <div class="qa-question">移植が失敗する確率はどのくらいですか？</div>
            <div class="qa-answer">
            自家歯牙移植の失敗率は、研究によって異なりますが、一般的に成功率が高いとされています。例えば、ある研究では生存率が90%で成功率が80%と報告されています。また、別の研究では生存率が94.6%で成功率が85.3%とされています。失敗の原因としては、歯根膜の治癒不良や炎症性吸収、付着の喪失などが挙げられます。特に、患者の年齢や歯の発育段階が成功率に影響を与える重要な要素とされています。
            </div>
        </div>

        <div class="latest-qa-item">            
            <div class="qa-question">費用はいくらぐらいかかりますか？</div>
            <div class="qa-answer">
            自家歯牙移植の費用は、保険適用かどうかによって異なります。保険が適用される場合、智歯や埋伏歯をドナー歯として使用することが条件です。この場合、患者の負担額は3割負担で約35,000円未満から40,000円未満です。一方、保険適用外の場合は、治療費用は歯科医院によって設定され、保険点数の10割を治療費としています。具体的な費用は治療内容や通院回数、歯科医院によって異なるため、詳細は担当の歯科医師に相談することをお勧めします。
            </div>
        </div>

        <div class="latest-qa-item">            
            <div class="qa-question">移植した歯は何年ぐらい持ちますか？</div>
            <div class="qa-answer">
            移植した歯の寿命については、短期から中期にかけて非常に高い成功率を示します。移植後1年までの生存率はほぼ100%で、2年で約95%、3年で約90%、5年で約85%と徐々に低下します。中期の安定性としては、移植後7年から15年までの期間で生存率が約75%前後を維持しています。長期的には、15年を過ぎると生存率が下降し始め、16年で約63%、18年で約53%、20年後には約50%程度まで低下します。これらのデータは、自家歯牙移植の長期予後を考える上で重要であり、患者への説明や治療計画立案の際に考慮すべき点です。
            </div>
        </div>

        <div class="latest-qa-item">            
            <div class="qa-question">手術後に気をつけることはありますか？</div>
            <div class="qa-answer">
            自家歯牙移植の手術後に気をつけることとして、以下の点が挙げられます。

            口腔衛生の管理: 手術後は口腔内の清潔を保つことが重要です。適切なブラッシングやうがいを行い、感染を防ぎます。
            定期的な経過観察: 術後の経過を確認するために、定期的に歯科医院を訪れ、エックス線写真や口腔内のチェックを受けることが必要です。
            食事の注意: 固い食べ物や粘着性のある食べ物は避け、移植部位に負担をかけないようにします。
            抗生物質の服用: 必要に応じて、術後に処方された抗生物質を指示通りに服用し、感染を予防します。
            痛みや腫れの管理: 手術後の痛みや腫れがある場合は、医師の指示に従って鎮痛剤を使用し、冷やすなどの対処を行います。
            生活習慣の見直し: 喫煙や過度の飲酒は治癒を遅らせる可能性があるため、控えることが推奨されます。
            定期的なメインテナンス: 長期的な成功のためには、定期的なメインテナンスと口腔衛生の維持が重要です。
            これらの注意点を守ることで、移植の成功率を高め、長期的な健康を維持することができます。
            </div>
        </div>

        <div class="latest-qa-item">            
            <div class="qa-question">インプラントより自家歯牙移植の方がいいのですか？</div>
            <div class="qa-answer">
            インプラントと自家歯牙移植のどちらが良いかは、患者の状況やニーズによって異なります。以下に主な比較ポイントを示します。

            生存率: インプラントは5年間の生存率が高く、94.2%から97.4%と報告されていますが、10年後には66.5%に低下することもあります。自家歯牙移植の5年後の生存率は95〜98%と高いものの、10年後には59.6%に低下することもあります。
            年齢: 若年者には自家歯牙移植が適しており、顎の成長が認められるうちはインプラントは推奨されません。40歳を超えるとインプラントが有利になるとされています。
            外科的侵襲: 自家歯牙移植は即時型であれば侵襲が少ないですが、無歯顎部型ではインプラントの方が骨の削合が少なく、患者の負担が少ないです。
            咬合と力の耐性: インプラントは側方力や回転力に弱いとされており、これらの力がかかりやすい部位では自家歯牙移植が有利かもしれません。
            骨・軟組織: インプラントは骨幅が狭くても施術しやすいですが、移植歯の方が軟組織との付着が強く、ペリオリスクが低いと考えられます。
            術後のメインテナンス: インプラントはう蝕のリスクがないため、カリエスリスクが高い患者には適しています。移植歯は天然歯に近いため、ブラッシングがしやすいです。
            コスト: 自家歯牙移植はインプラントよりもコストが低いとされています。
            これらの要因を考慮し、個々のケースに応じてどちらが適しているかを判断する必要があります。。
            </div>
        </div>

        <div class="latest-qa-item">            
            <div class="qa-question">親知らず以外でも移植に使えますか？</div>
            <div class="qa-answer">
            親知らず以外の歯も、自分の歯を移植する治療（自家歯牙移植）に使うことができます。
            たとえば、歯の本数が多くて余分に生えている小臼歯（過剰歯）や、矯正治療のために抜く予定の小臼歯などが移植用の歯として選ばれることがあります。
            移植に向いているかどうかは、
            歯のまわりの組織（歯根膜）が健康かどうか
            歯の根の形が移植に適しているか
            移植する場所の骨の幅にきちんと合うか
            といった条件を考えて判断されます。
            </div>
        </div>

        <div class="latest-qa-item">            
            <div class="qa-question">上顎前歯の自家移植は可能ですか？</div>
            <div class="qa-answer">
             上顎前歯の自家歯牙移植は可能です。いくつかの症例が示されており、以下にその概要を説明します。<br>

               <b> 症例1: 第二小臼歯の前歯部への移植</b><br>
                21歳の男性で、上顎中切歯が外傷で喪失したケースです。下顎右側の過剰埋伏小臼歯をドナーとして移植し、天然歯特有の審美性と機能性の回復が期待されました。<br>
                <b> 症例2: 転位傾斜萌出小臼歯の前歯部への移植</b><br>
                50歳の男性で、歯根破折により抜歯が必要となったケースです。転位傾斜萌出した歯をドナーとして移植し、唇側の歯槽骨が再生し、歯冠修復が行われました。<br>
                <b> 矯正治療における自家歯牙移植</b><br>
                外傷により上顎前歯を喪失した患者に対して、下顎小臼歯を上顎に移植することで、審美性と機能性の回復を図るケースがあります。移植後の矯正治療により、歯の位置や形態を調整します。<br>
                これらの症例では、ドナー歯の選択や移植後の治療計画が重要であり、特に審美性の回復が求められる上顎前歯の移植では、慎重な計画と技術が必要です。<br>
            </div>
        </div>        
              
    </section>

    <!-- AI質問ボックス -->
    <div class="search-box mt-4">
        <h3>上記にご希望の質問が見つからなかった場合、ご質問ください</h3>
        <p class="mb-3">自家歯牙移植専門AI「raiden」がお答えします(患者様向けの応答)</p>
        <div class="qa-input-container">
            <textarea class="qa-input" placeholder="質問を入力してください（例：「40歳でも自家歯牙移植は可能ですか？」「費用はどのくらいかかりますか？」）" id="raiden-question" rows="3"></textarea>
            <button class="btn btn-primary mt-2" id="ask-raiden">raidenに質問する</button>
        </div>
        <div id="raiden-response" class="raiden-response" style="display: none;">
            <div class="response-header">
                <strong>raidenの回答:</strong>
                <button class="btn btn-sm btn-outline-secondary float-end" id="save-qa">この回答をQ&Aに追加</button>
            </div>
            <div class="response-content" id="response-text"></div>
        </div>

<!-- raiden連携機能のJavaScript -->
<script>
document.addEventListener('DOMContentLoaded', function() {
    const questionInput = document.getElementById('raiden-question');
    const askButton = document.getElementById('ask-raiden');
    const responseDiv = document.getElementById('raiden-response');
    const responseText = document.getElementById('response-text');
    const saveQAButton = document.getElementById('save-qa');

    // 患者様向けプロンプト設定
    const PATIENT_PROMPT = `
あなたは自家歯牙移植専門の歯科医師として、患者様に分かりやすく説明する役割です。
以下のガイドラインに従って回答してください：

1. 患者様にとって理解しやすい言葉を使用する
2. 専門用語は必ず分かりやすく説明を加える
3. 不安や心配を和らげる、優しく親しみやすい口調で回答する
4. 具体的で実用的な情報を提供する
5. 必要に応じて、「歯科医師にご相談ください」という文言を含める
6. 医療行為に関する断定的な表現は避け、「一般的には」「多くの場合」などの表現を使う
7. 費用や期間については目安を示し、個人差があることを説明する

患者様からの質問: `;

    // raidenに質問を送信する関数
    async function askRaiden(question) {
        try {
            // ローディング表示
            askButton.disabled = true;
            askButton.textContent = '回答生成中...';
            
            // 患者様向けプロンプトを質問に追加
            const promptedQuestion = PATIENT_PROMPT + question;
            
            const response = await fetch('https://raiden.shibuya8020.com/api/question', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ 
                    question: promptedQuestion,
                    // 追加のパラメータで患者向けであることを明示
                    context: {
                        audience: 'patient',
                        tone: 'friendly',
                        language_level: 'beginner'
                    }
                })
            });

            const data = await response.json();

            if (data.success) {
                // 回答を表示
                responseText.innerHTML = formatResponse(data.answer);
                responseDiv.style.display = 'block';
                
                // 回答をスムーズにスクロール
                responseDiv.scrollIntoView({ 
                    behavior: 'smooth', 
                    block: 'nearest' 
                });
                
                return data.answer;
            } else {
                throw new Error(data.error || '不明なエラーが発生しました');
            }

        } catch (error) {
            console.error('Error:', error);
            
            // エラーメッセージを表示
            responseText.innerHTML = `
                <div class="alert alert-danger">
                    <strong>エラー:</strong> ${error.message}
                    <br><small>raidenサーバーが起動しているか確認してください。</small>
                </div>
            `;
            responseDiv.style.display = 'block';
            
        } finally {
            // ボタンの状態を復元
            askButton.disabled = false;
            askButton.textContent = 'raidenに質問する';
        }
    }

    // 回答をHTML形式でフォーマットする関数（患者様向けに調整）
    function formatResponse(response) {
        // Markdownライクなフォーマットを患者様向けHTMLに変換
        let formatted = response
            // **太字** を <strong> に変換
            .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
            // 改行を <br> に変換
            .replace(/\n/g, '<br>')
            // リスト項目（- で始まる行）を患者様向けに整理
            .replace(/^- (.+)/gm, '<div class="patient-list-item">• $1</div>')
            // 数字付きリスト
            .replace(/^\d+\. (.+)/gm, '<div class="patient-numbered-item">$&</div>')            
        
        return `
            <div class="response-content patient-friendly">
                ${formatted}
                <hr>
                <small class="text-muted">
                    <i class="fas fa-info-circle"></i> 
                    この回答は一般的な情報提供を目的としています。
                    具体的な治療については、必ず歯科医師にご相談ください。
                </small>
            </div>
        `;
    }

    // 質問ボタンのクリックイベント
    askButton.addEventListener('click', async function() {
        const question = questionInput.value.trim();
        
        if (!question) {
            alert('質問を入力してください。');
            return;
        }

        await askRaiden(question);
    });

    // Enterキーでの送信（Shift+Enterは改行）
    questionInput.addEventListener('keydown', function(event) {
        if (event.key === 'Enter' && !event.shiftKey) {
            event.preventDefault();
            askButton.click();
        }
    });

    // Q&Aに追加するボタンのイベント
    saveQAButton.addEventListener('click', function() {
        const question = questionInput.value.trim();
        const answer = responseText.textContent || responseText.innerText;
        
        if (question && answer) {
            // 患者様向け回答として保存
            saveToQASystem(question, answer);
        }
    });

    // Q&Aシステムへの保存（患者様向けフラグ付き）
    function saveToQASystem(question, answer) {
        fetch('/admin/api/save-qa', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({
                question: question,
                answer: answer,
                source: 'raiden',
                audience: 'patient', // 患者様向けフラグ
                timestamp: new Date().toISOString()
            })
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                alert('患者様向けQ&Aに追加されました！');
            } else {
                alert('保存に失敗しました。');
            }
        })
        .catch(error => {
            console.error('Save error:', error);
            alert('保存中にエラーが発生しました。');
        });
    }

    // raidenの稼働状況をチェックする関数
    async function checkRaidenStatus() {
        try {
            const response = await fetch('https://raiden.shibuya8020.com/api/health');
            const data = await response.json();
            
            if (data.status === 'healthy') {
                console.log('Raiden is running properly');
                return true;
            }
        } catch (error) {
            console.warn('Raiden health check failed:', error);
            return false;
        }
    }

    // 初期化時にraidenの状態をチェック
    checkRaidenStatus().then(isHealthy => {
        if (!isHealthy) {
            // raidenが起動していない場合の警告表示
            const warningDiv = document.createElement('div');
            warningDiv.className = 'alert alert-warning';
            warningDiv.innerHTML = `
                <strong>注意:</strong> raidenサーバーに接続できません。
                <br><small>サーバーが起動していることを確認してください。</small>
            `;
            document.querySelector('.search-box').insertBefore(warningDiv, document.querySelector('.qa-input-container'));
        }
    });
});
</script>


{% endblock %}

