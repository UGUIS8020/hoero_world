{% extends "common/base.html" %}

{% block title %}{{ post.content[:20] }}... | STL Board{% endblock %}

{% block content %}
<div class="container mt-4">
  <div class="timeline-container">
    <div class="post-item">
      <!-- æŠ•ç¨¿ãƒ˜ãƒƒãƒ€ãƒ¼ -->
      <div class="post-header">
        <strong>{{ post.author.display_name }}</strong>
        <span>{{ post.created_at.strftime('%Y-%m-%d %H:%M') }}</span>
      </div>
      
      <!-- æŠ•ç¨¿æœ¬æ–‡ -->
      <div class="post-body">
        {{ post.content or "ï¼ˆæœ¬æ–‡ãªã—ï¼‰" }}
      </div>
      
      <!-- ãƒ¢ãƒ‡ãƒ«ãƒ“ãƒ¥ãƒ¼ã‚¢ãƒ¼ -->
      {% if post.s3_presigned_url %}
      <div class="model-viewer-container">
        <model-viewer src="{{ post.s3_presigned_url }}"
                      auto-rotate
                      camera-controls
                      style="width: 100%; height: 400px; background-color: #fff;">
        </model-viewer>
      </div>
      {% endif %}
      
      <!-- ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ -->
      <div class="post-actions">
        <form method="POST" action="{{ url_for('stl_board.like_post', post_id=post.id) }}">
          <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
          <button type="submit">â¤ï¸ {{ post.likes.count() }}</button>
        </form>
        <a href="#comments">ğŸ’¬ ã‚³ãƒ¡ãƒ³ãƒˆ</a>
        <button onclick="copyToClipboard(window.location.href)">ğŸ“‹ URLã‚’ã‚³ãƒ”ãƒ¼</button>
      </div>
      
      <!-- ã‚³ãƒ¡ãƒ³ãƒˆã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
      <h5 class="mt-4" id="comments">ã‚³ãƒ¡ãƒ³ãƒˆ</h5>
      {% for comment in comments %}
        {% if not comment.parent_comment_id %}
        <div class="comment-item">
          <div class="comment-header">
            {{ comment.author.display_name }} ãƒ» {{ comment.created_at.strftime('%Y-%m-%d %H:%M') }}
          </div>
          <div>{{ comment.content }}</div>
        </div>
        {% endif %}
      {% endfor %}
      
      <!-- ã‚³ãƒ¡ãƒ³ãƒˆæŠ•ç¨¿ãƒ•ã‚©ãƒ¼ãƒ  -->
      {% if current_user.is_authenticated %}
      <form method="POST" action="{{ url_for('stl_board.add_comment', post_id=post.id) }}"
            class="comment-form mt-3">
        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
        <textarea name="content" rows="2" required placeholder="è¿”ä¿¡ã‚’å…¥åŠ›â€¦"></textarea>
        <button class="btn btn-sm btn-outline-primary" type="submit">è¿”ä¿¡ã™ã‚‹</button>
      </form>
      {% endif %}
    </div>
  </div>
  
  <div class="mt-4">
    <a href="{{ url_for('stl_board.index') }}" class="btn btn-outline-secondary">â† ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³ã«æˆ»ã‚‹</a>
  </div>
</div>

<script>
function copyToClipboard(text) {
  navigator.clipboard.writeText(text).then(function() {
    alert('URLã‚’ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸ');
  }, function() {
    alert('ã‚³ãƒ”ãƒ¼ã§ãã¾ã›ã‚“ã§ã—ãŸ');
  });
}
</script>
{% endblock %}