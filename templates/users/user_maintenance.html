{% extends "common/base.html" %}
{% block content %}

    <header id="page-header">
        <div class="container my-3 py-3 bg-light">
            <div class="row">
                <div class="col-md-6 m-auto text-center">
                    <h1>ユーザー管理</h1>
                </div>
            </div>
        </div>
    </header>

    {% if current_user.is_administrator %}
    <section id="menu">
        <div class="container my-3 py-3 bg-light">
            <div class="row">
                <div class="col-md-3">
                    <a href="{{ url_for('users.register') }}" class="btn btn-primary w-100">
                        ユーザー登録
                    </a>
                </div>
            </div>
        </div>
    </section>
    {% endif %}

    <section id="list">
        <div class="container my-3">
            <div class="row">
                <div class="col-md-9">
                    <div class="card">
                        <div class="card-header">
                            <h4>最新のユーザー</h4>
                        </div>
                        <div class="table-responsive">
                            <table class="table table-striped text-nowrap">
                                <thead class="table-dark">
                                    <tr>
                                        <th>ID</th>
                                        <th>ユーザー名</th>
                                        <th>メールアドレス</th>
                                        <th>管理者</th>
                                        <th>ブログ投稿数</th>
                                        <th>変更</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for user in users.items %}
                                    <tr>
                                        {# 1列目: 単純に連番でOK #}
                                        <td>{{ loop.index }}</td>

                                        {# 2列目: ユーザー名 #}
                                        <td>{{ user.display_name | truncate(10) }}</td>

                                        {# 3列目: メールアドレス #}
                                        <td>{{ user.email | truncate(20) }}</td>

                                        {# 4列目: 管理者フラグ（True / False を ○ / - にしてもよい） #}
                                        <td>
                                        {% if user.is_administrator %}
                                            管理者
                                        {% else %}
                                            一般
                                        {% endif %}
                                        </td>

                                        {# 5列目: ブログ投稿数（事前に user.post_count を作ってあればそのまま表示） #}
                                        <td>{{ user.post_count }}</td>

                                        {# 6列目: 変更ボタン #}
                                        <td>
                                        {% if user.email == current_user.email %}
                                            <!-- 自分自身のときだけ、DynamoDB版アカウント編集へ -->
                                            <a href="{{ url_for('users.account_me') }}" class="btn btn-secondary">
                                            編集
                                            </a>
                                        {% else %}
                                            <!-- まだ他ユーザー編集は未対応なのでダミー表示 -->
                                            <span class="text-muted">-</span>
                                        {% endif %}
                                        </td>
                                    </tr>
                                    {% endfor %}
                                    </tbody>
                            </table>
                        </div>    
                    </div>
                </div>
            </div>
        </div>
    </section>

    <nav class="my-2" aria-label="Page navigation">
    <ul class="pagination justify-content-center">
            {# 前へ #}
            <li {% if users.has_prev %}class="page-item"{% else %} class="page-item disabled"{% endif %}>
                <a class="page-link"
                href="{% if users.has_prev %}{{ url_for('users.user_maintenance', page=users.prev_num) }}{% else %}#{% endif %}">
                    前へ
                </a>
            </li>

            {# ★ここを iter_pages → range に変更 #}
            {% for page_num in range(1, users.pages + 1) %}
                {% if users.page == page_num %}
                    <li class="page-item disabled">
                        <a class="page-link" href="#">{{ page_num }}</a>
                    </li>
                {% else %}
                    <li class="page-item">
                        <a class="page-link"
                        href="{{ url_for('users.user_maintenance', page=page_num) }}">{{ page_num }}</a>
                    </li>
                {% endif %}
            {% endfor %}

            {# 次へ #}
            <li {% if users.has_next %}class="page-item"{% else %} class="page-item disabled"{% endif %}>
                <a class="page-link"
                href="{% if users.has_next %}{{ url_for('users.user_maintenance', page=users.next_num) }}{% else %}#{% endif %}">
                    次へ
                </a>
            </li>
        </ul>
    </nav>

{% endblock %}